<HTML>

<!-- Generated by c2html-1.0, Copyright 1998 by Dave Whittington -->
<HEAD>
<TITLE>b1lli.h</TITLE>
<!--#include virtual="/ssi/js.shtml" -->
<!--#include virtual="/ssi/buttondefs.shtml" -->
</HEAD>
<BODY BGCOLOR="#FFFFFF">
<TABLE WIDTH="100%">
<TR>
<TD ALIGN=LEFT WIDTH="90"><!--#include virtual="/ssi/b_home.shtml" --></TD>
<TD ALIGN=RIGHT WIDTH="90"><!--#include virtual="/ssi/b_up.shtml" --></TD>
</TR>
</TABLE>
<CENTER><H1>b1lli.h</H1></CENTER>

<HR>
<PRE>
<FONT COLOR=#0000FF>/*
 * $Id$
 *
 * ISDN lowlevel-module for AVM B1-card.
 *
 * Copyright 1996 by Carsten Paeth (calle@calle.in-berlin.de)
 *
 * $Log$
 * Revision 1.4  1998/03/29 16:05:02  calle
 * changes from 2.0 tree merged.
 *
 * Revision 1.1.2.9  1998/03/20 14:30:02  calle
 * added cardnr to detect if you try to add same T1 to different io address.
 * change number of nccis depending on number of channels.
 *
 * Revision 1.1.2.8  1998/03/04 17:32:33  calle
 * Changes for T1.
 *
 * Revision 1.1.2.7  1998/02/27 15:38:29  calle
 * T1 running with slow link.
 *
 * Revision 1.1.2.6  1998/02/24 17:57:36  calle
 * changes for T1.
 *
 * Revision 1.3  1998/01/31 10:54:37  calle
 * include changes for PCMCIA cards from 2.0 version
 *
 * Revision 1.2  1997/12/10 19:38:42  calle
 * get changes from 2.0 tree
 *
 * Revision 1.1.2.2  1997/11/26 16:57:26  calle
 * more changes for B1/M1/T1.
 *
 * Revision 1.1.2.1  1997/11/26 10:47:01  calle
 * prepared for M1 (Mobile) and T1 (PMX) cards.
 * prepared to set configuration after load to support other D-channel
 * protocols, point-to-point and leased lines.
 *
 * Revision 1.1  1997/03/04 21:27:32  calle
 * First version in isdn4linux
 *
 * Revision 2.2  1997/02/12 09:31:39  calle
 * new version
 *
 * Revision 1.1  1997/01/31 10:32:20  calle
 * Initial revision
 *
 */</FONT>

<FONT COLOR=#A521F7>#ifndef</FONT> <A HREF="#_B1LLI_H_">_B1LLI_H_</A>
<FONT COLOR=#A521F7>#define</FONT> <A NAME="_B1LLI_H_">_B1LLI_H_</A>
<FONT COLOR=#0000FF>/*
 * struct for loading t4 file 
 */</FONT>
<FONT COLOR="#298C52">typedef</FONT> <FONT COLOR="#298C52">struct</FONT> <A NAME="avmb1_t4file">avmb1_t4file</A> {
	<FONT COLOR="#298C52">int</FONT> len;
	<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">char</FONT> *data;
} <A HREF="#avmb1_t4file">avmb1_t4file</A>;

<FONT COLOR="#298C52">typedef</FONT> <FONT COLOR="#298C52">struct</FONT> <A NAME="avmb1_loaddef">avmb1_loaddef</A> {
	<FONT COLOR="#298C52">int</FONT> contr;
	<A HREF="#avmb1_t4file">avmb1_t4file</A> t4file;
} <A HREF="#avmb1_loaddef">avmb1_loaddef</A>;

<FONT COLOR="#298C52">typedef</FONT> <FONT COLOR="#298C52">struct</FONT> <A NAME="avmb1_loadandconfigdef">avmb1_loadandconfigdef</A> {
	<FONT COLOR="#298C52">int</FONT> contr;
	<A HREF="#avmb1_t4file">avmb1_t4file</A> t4file;
        <A HREF="#avmb1_t4file">avmb1_t4file</A> t4config; 
} <A HREF="#avmb1_loadandconfigdef">avmb1_loadandconfigdef</A>;

<FONT COLOR="#298C52">typedef</FONT> <FONT COLOR="#298C52">struct</FONT> <A NAME="avmb1_resetdef">avmb1_resetdef</A> {
	<FONT COLOR="#298C52">int</FONT> contr;
} <A HREF="#avmb1_resetdef">avmb1_resetdef</A>;

<FONT COLOR="#298C52">typedef</FONT> <FONT COLOR="#298C52">struct</FONT> <A NAME="avmb1_getdef">avmb1_getdef</A> {
	<FONT COLOR="#298C52">int</FONT> contr;
	<FONT COLOR="#298C52">int</FONT> cardtype;
	<FONT COLOR="#298C52">int</FONT> cardstate;
} <A HREF="#avmb1_getdef">avmb1_getdef</A>;

<FONT COLOR=#0000FF>/*
 * struct for adding new cards 
 */</FONT>
<FONT COLOR="#298C52">typedef</FONT> <FONT COLOR="#298C52">struct</FONT> <A NAME="avmb1_carddef">avmb1_carddef</A> {
	<FONT COLOR="#298C52">int</FONT> port;
	<FONT COLOR="#298C52">int</FONT> irq;
} <A HREF="#avmb1_carddef">avmb1_carddef</A>;

<FONT COLOR=#A521F7>#define</FONT> <A NAME="AVM_CARDTYPE_B1">AVM_CARDTYPE_B1</A>	0
<FONT COLOR=#A521F7>#define</FONT> <A NAME="AVM_CARDTYPE_T1">AVM_CARDTYPE_T1</A>	1
<FONT COLOR=#A521F7>#define</FONT> <A NAME="AVM_CARDTYPE_M1">AVM_CARDTYPE_M1</A>	2
<FONT COLOR=#A521F7>#define</FONT> <A NAME="AVM_CARDTYPE_M2">AVM_CARDTYPE_M2</A>	3

<FONT COLOR="#298C52">typedef</FONT> <FONT COLOR="#298C52">struct</FONT> <A NAME="avmb1_extcarddef">avmb1_extcarddef</A> {
	<FONT COLOR="#298C52">int</FONT> port;
	<FONT COLOR="#298C52">int</FONT> irq;
        <FONT COLOR="#298C52">int</FONT> cardtype;
        <FONT COLOR="#298C52">int</FONT> cardnr;  <FONT COLOR=#0000FF>/* for HEMA/T1 */</FONT>
} <A HREF="#avmb1_extcarddef">avmb1_extcarddef</A>;

<FONT COLOR=#A521F7>#define</FONT>	<A NAME="AVMB1_LOAD">AVMB1_LOAD</A>		0	<FONT COLOR=#0000FF>/* load image to card */</FONT>
<FONT COLOR=#A521F7>#define</FONT> <A NAME="AVMB1_ADDCARD">AVMB1_ADDCARD</A>		1	<FONT COLOR=#0000FF>/* add a new card */</FONT>
<FONT COLOR=#A521F7>#define</FONT> <A NAME="AVMB1_RESETCARD">AVMB1_RESETCARD</A>		2	<FONT COLOR=#0000FF>/* reset a card */</FONT>
<FONT COLOR=#A521F7>#define</FONT>	<A NAME="AVMB1_LOAD_AND_CONFIG">AVMB1_LOAD_AND_CONFIG</A>	3	<FONT COLOR=#0000FF>/* load image and config to card */</FONT>
<FONT COLOR=#A521F7>#define</FONT>	<A NAME="AVMB1_ADDCARD_WITH_TYPE">AVMB1_ADDCARD_WITH_TYPE</A>	4	<FONT COLOR=#0000FF>/* add a new card, with cardtype */</FONT>
<FONT COLOR=#A521F7>#define</FONT> <A NAME="AVMB1_GET_CARDINFO">AVMB1_GET_CARDINFO</A>	5	<FONT COLOR=#0000FF>/* get cardtype */</FONT>
<FONT COLOR=#A521F7>#define</FONT> <A NAME="AVMB1_REMOVECARD">AVMB1_REMOVECARD</A>	6	<FONT COLOR=#0000FF>/* remove a card (usefull for T1) */</FONT>



<FONT COLOR=#0000FF>/*
 * card states for startup
 */</FONT>

<FONT COLOR=#A521F7>#define</FONT> <A NAME="CARD_FREE">CARD_FREE</A>	0
<FONT COLOR=#A521F7>#define</FONT> <A NAME="CARD_DETECTED">CARD_DETECTED</A>	1
<FONT COLOR=#A521F7>#define</FONT> <A NAME="CARD_LOADING">CARD_LOADING</A>	2
<FONT COLOR=#A521F7>#define</FONT> <A NAME="CARD_INITSTATE">CARD_INITSTATE</A>	4
<FONT COLOR=#A521F7>#define</FONT> <A NAME="CARD_RUNNING">CARD_RUNNING</A>	5
<FONT COLOR=#A521F7>#define</FONT> <A NAME="CARD_ACTIVE">CARD_ACTIVE</A>	6

<FONT COLOR=#A521F7>#ifdef</FONT> __KERNEL__

<FONT COLOR=#A521F7>#define</FONT>	<A NAME="AVMB1_PORTLEN">AVMB1_PORTLEN</A>		0x1f

<FONT COLOR=#A521F7>#define</FONT> <A NAME="AVM_MAXVERSION">AVM_MAXVERSION</A>		8

<FONT COLOR=#A521F7>#define</FONT> <A NAME="AVM_NAPPS">AVM_NAPPS</A>		30
<FONT COLOR=#A521F7>#define</FONT> <A NAME="AVM_NNCCI_PER_CHANNEL">AVM_NNCCI_PER_CHANNEL</A>	4

<FONT COLOR=#0000FF>/*
 * Main driver data
 */</FONT>

<FONT COLOR="#298C52">typedef</FONT> <FONT COLOR="#298C52">struct</FONT> <A NAME="avmb1_card">avmb1_card</A> {
	<FONT COLOR="#298C52">struct</FONT> <A HREF="#avmb1_card">avmb1_card</A> *next;
	<FONT COLOR="#298C52">int</FONT> cnr;
	<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> port;
	<FONT COLOR="#298C52">unsigned</FONT> irq;
	<FONT COLOR="#298C52">int</FONT> cardtype;
	<FONT COLOR="#298C52">int</FONT> cardnr; <FONT COLOR=#0000FF>/* for T1-HEMA */</FONT>
	<FONT COLOR="#298C52">volatile</FONT> <FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> cardstate;
	<FONT COLOR="#298C52">int</FONT> interrupt;
	<FONT COLOR="#298C52">int</FONT> blocked;
	<FONT COLOR="#298C52">int</FONT> versionlen;
	<FONT COLOR="#298C52">char</FONT> versionbuf[1024];
	<FONT COLOR="#298C52">char</FONT> *version[<A HREF="#AVM_MAXVERSION">AVM_MAXVERSION</A>];
	<FONT COLOR="#298C52">char</FONT> msgbuf[128];	<FONT COLOR=#0000FF>/* capimsg msg part */</FONT>
	<FONT COLOR="#298C52">char</FONT> databuf[2048];	<FONT COLOR=#0000FF>/* capimsg data part */</FONT>
	<A HREF="capi.h.shtml#capi_version">capi_version</A> cversion;
	<FONT COLOR="#298C52">char</FONT> name[10];
} <A HREF="#avmb1_card">avmb1_card</A>;

<FONT COLOR=#0000FF>/*
 * Versions
 */</FONT>

<FONT COLOR=#A521F7>#define</FONT>	<A NAME="VER_DRIVER">VER_DRIVER</A>	0
<FONT COLOR=#A521F7>#define</FONT>	<A NAME="VER_CARDTYPE">VER_CARDTYPE</A>	1
<FONT COLOR=#A521F7>#define</FONT>	<A NAME="VER_HWID">VER_HWID</A>	2
<FONT COLOR=#A521F7>#define</FONT>	<A NAME="VER_SERIAL">VER_SERIAL</A>	3
<FONT COLOR=#A521F7>#define</FONT>	<A NAME="VER_OPTION">VER_OPTION</A>	4
<FONT COLOR=#A521F7>#define</FONT>	<A NAME="VER_PROTO">VER_PROTO</A>	5
<FONT COLOR=#A521F7>#define</FONT>	<A NAME="VER_PROFILE">VER_PROFILE</A>	6
<FONT COLOR=#A521F7>#define</FONT>	<A NAME="VER_CAPI">VER_CAPI</A>	7


<FONT COLOR=#0000FF>/* b1lli.c */</FONT>
<FONT COLOR="#298C52">int</FONT> B1_detect(<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> base, <FONT COLOR="#298C52">int</FONT> cardtype);
<FONT COLOR="#298C52">int</FONT> T1_detectandinit(<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> base, <FONT COLOR="#298C52">unsigned</FONT> irq, <FONT COLOR="#298C52">int</FONT> cardnr);
<FONT COLOR="#298C52">void</FONT> B1_reset(<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> base);
<FONT COLOR="#298C52">void</FONT> T1_reset(<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> base);
<FONT COLOR="#298C52">int</FONT> B1_load_t4file(<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> base, <A HREF="#avmb1_t4file">avmb1_t4file</A> * t4file);
<FONT COLOR="#298C52">int</FONT> B1_load_config(<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> base, <A HREF="#avmb1_t4file">avmb1_t4file</A> * config);
<FONT COLOR="#298C52">int</FONT> B1_loaded(<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> base);
<FONT COLOR="#298C52">void</FONT> B1_setinterrupt(<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> base, <FONT COLOR="#298C52">unsigned</FONT> irq, <FONT COLOR="#298C52">int</FONT> cardtype);
<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">char</FONT> B1_disable_irq(<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> base);
<FONT COLOR="#298C52">void</FONT> T1_disable_irq(<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> base);
<FONT COLOR="#298C52">int</FONT> B1_valid_irq(<FONT COLOR="#298C52">unsigned</FONT> irq, <FONT COLOR="#298C52">int</FONT> cardtype);
<FONT COLOR="#298C52">int</FONT> B1_valid_port(<FONT COLOR="#298C52">unsigned</FONT> port, <FONT COLOR="#298C52">int</FONT> cardtype);
<FONT COLOR="#298C52">void</FONT> B1_handle_interrupt(<A HREF="#avmb1_card">avmb1_card</A> * card);
<FONT COLOR="#298C52">void</FONT> B1_send_init(<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> port,
	    <FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">int</FONT> napps, <FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">int</FONT> nncci, <FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">int</FONT> cardnr);
<FONT COLOR="#298C52">void</FONT> B1_send_register(<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> port,
		      __u16 appid, __u32 nmsg,
		      __u32 nb3conn, __u32 nb3blocks, __u32 b3bsize);
<FONT COLOR="#298C52">void</FONT> B1_send_release(<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> port, __u16 appid);
<FONT COLOR="#298C52">void</FONT> B1_send_message(<FONT COLOR="#298C52">unsigned</FONT> <FONT COLOR="#298C52">short</FONT> port, <FONT COLOR="#298C52">struct</FONT> sk_buff *skb);

<FONT COLOR=#0000FF>/* b1capi.c */</FONT>
<FONT COLOR="#298C52">void</FONT> avmb1_handle_new_ncci(<A HREF="#avmb1_card">avmb1_card</A> * card,
			   __u16 appl, __u32 ncci, __u32 winsize);
<FONT COLOR="#298C52">void</FONT> avmb1_handle_free_ncci(<A HREF="#avmb1_card">avmb1_card</A> * card,
			    __u16 appl, __u32 ncci);
<FONT COLOR="#298C52">void</FONT> avmb1_handle_capimsg(<A HREF="#avmb1_card">avmb1_card</A> * card, __u16 appl, <FONT COLOR="#298C52">struct</FONT> sk_buff *skb);
<FONT COLOR="#298C52">void</FONT> avmb1_card_ready(<A HREF="#avmb1_card">avmb1_card</A> * card);

<FONT COLOR=#0000FF>/* standard calls, with check and allocation of resources */</FONT>
<FONT COLOR="#298C52">int</FONT> avmb1_addcard(<FONT COLOR="#298C52">int</FONT> port, <FONT COLOR="#298C52">int</FONT> irq, <FONT COLOR="#298C52">int</FONT> cardtype);
<FONT COLOR="#298C52">int</FONT> avmb1_probecard(<FONT COLOR="#298C52">int</FONT> port, <FONT COLOR="#298C52">int</FONT> irq, <FONT COLOR="#298C52">int</FONT> cardtype);


<FONT COLOR="#298C52">int</FONT> avmb1_resetcard(<FONT COLOR="#298C52">int</FONT> cardnr);

<FONT COLOR=#0000FF>/* calls for pcmcia driver */</FONT>
<FONT COLOR="#298C52">int</FONT> avmb1_detectcard(<FONT COLOR="#298C52">int</FONT> port, <FONT COLOR="#298C52">int</FONT> irq, <FONT COLOR="#298C52">int</FONT> cardtype);
<FONT COLOR="#298C52">int</FONT> avmb1_registercard(<FONT COLOR="#298C52">int</FONT> port, <FONT COLOR="#298C52">int</FONT> irq, <FONT COLOR="#298C52">int</FONT> cardtype, <FONT COLOR="#298C52">int</FONT> allocio);
<FONT COLOR="#298C52">int</FONT> avmb1_unregistercard(<FONT COLOR="#298C52">int</FONT> cnr, <FONT COLOR="#298C52">int</FONT> freeio);

<FONT COLOR=#A521F7>#endif</FONT>				<FONT COLOR=#0000FF>/* __KERNEL__ */</FONT>

<FONT COLOR=#A521F7>#endif</FONT>				<FONT COLOR=#0000FF>/* _B1LLI_H_ */</FONT>
</BODY>

</HTML>
